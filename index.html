<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SELT Map - Social Enterprise Legislative Tracker</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Frank+Ruhl+Libre:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #00abce 0%, #73a535 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .grunin-branding {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 30px;
            margin-bottom: 30px;
            width: 100%;
        }

        .grunin-logo-img {
            width: 300px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background: white;
            padding: 20px;
        }

        .grunin-title {
            text-align: left;
            flex: 1;
        }

        .grunin-name {
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 8px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .grunin-subtitle {
            font-size: 1.3em;
            font-weight: 400;
            color: rgba(255,255,255,0.9);
            font-family: 'Frank Ruhl Libre', serif;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }
        
        /* Content Sections */
        .content-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .content-section h2 {
            font-size: 1.8em;
            color: #925333;
            margin-bottom: 20px;
            font-weight: 600;
            border-bottom: 3px solid #00abce;
            padding-bottom: 10px;
        }

        .content-section p {
            font-size: 1.05em;
            line-height: 1.7;
            color: #333;
            margin-bottom: 15px;
            font-family: 'Frank Ruhl Libre', serif;
        }
        
        .content-section p strong {
            color: #925333;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
        }
        
        /* Map Section with Enhanced Controls */
        .map-section {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            position: relative;
        }
        
        .map-controls {
            background: linear-gradient(to bottom, #f8f9fa, #ffffff);
            padding: 20px;
            border-bottom: 2px solid #00abce;
        }
        
        .controls-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-label {
            font-weight: 600;
            color: #925333;
            font-size: 14px;
        }
        
        /* Selects and Buttons */
        select, button {
            padding: 8px 15px;
            border: 2px solid #73a535;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
        }
        
        select:hover, button:hover {
            border-color: #00abce;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        select:focus, button:focus {
            outline: none;
            border-color: #00abce;
            box-shadow: 0 0 0 3px rgba(0, 171, 206, 0.2);
        }
        
        /* Legend */
        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #666;
        }
        
        /* Map Layout */
        .map-content {
            height: 600px;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
            background: #e6f3f7;
            position: relative;
        }
        
      
        

        
        .history-btn {
            width: 100%;
            background: linear-gradient(135deg, #00abce, #73a535);
            color: white;
            padding: 12px;
            border: none;
            font-weight: 600;
        }
        
        .history-btn:hover {
            background: linear-gradient(135deg, #925333, #73a535);
        }
        
        /* Leader Lines for Northeast States */
        .leader-line {
            stroke: #333;
            stroke-width: 1.5;
            fill: none;
            opacity: 0.7;
            stroke-dasharray: 3,3;
        }
        
        /* Inset Boxes for Alaska and Hawaii */
        .inset-box {
            position: absolute;
            background: #e6f3f7;
            border: 2px solid #999;
            border-radius: 8px;
            padding: 8px 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            cursor: pointer;
        }
        
        .alaska-box {
            top: 20px;
            left: 20px;
            width: 110px;
            height: 85px;
        }
        
        .hawaii-box {
            bottom: 20px;
            left: 20px;
            width: 110px;
            height: 65px;
        }
        
        /* SVG state shapes */
        .state-shape-svg {
            width: 100%;
            height: calc(100% - 25px);
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .state-shape-path, .hawaii-island {
            fill: #e6f3f7;
            stroke: #666;
            stroke-width: 1;
            transition: all 0.3s;
        }
        
        .inset-box:hover .state-shape-path,
        .inset-box:hover .hawaii-island {
            fill: rgba(0,171,206,0.1);
        }
        
        .state-shape-path.selected,
        .hawaii-island.selected {
            fill: rgba(0,171,206,0.2);
            stroke: #00abce;
            stroke-width: 2;
        }
        
        .inset-state-label {
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            pointer-events: none;
            font-weight: 600;
            font-size: 12px;
            color: #333;
            background: rgba(255,255,255,0.95);
            padding: 2px 8px;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
            z-index: 10;
            white-space: nowrap;
        }
        
        /* State Badge Styles */
        .state-badge {
            background: white;
            padding: 5px 8px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            border: 2px solid #00abce;
            white-space: nowrap;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .state-badge.selected {
            background: #00abce;
            color: white;
            border-color: #925333;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000 !important;
        }
        
        .state-badge.northeast {
            font-size: 11px;
            padding: 3px 6px;
        }
        
        .state-badge-marker {
            background: transparent !important;
            border: none !important;
            z-index: 400 !important;
        }
        
        .state-badge-marker.selected-marker {
            z-index: 1000 !important;
        }
        
        /* Stats Bar Section - Inside Map Box */
        .stats-bar {
            background: linear-gradient(to bottom, #f8f9fa, #ffffff);
            border-top: 2px solid #00abce;
            padding: 25px 30px;
            display: flex;
            align-items: stretch;
            gap: 40px;
            min-height: 180px;
            overflow: hidden;
            position: relative;
        }

        .stats-year-indicator {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0 20px;
            border-right: 2px solid rgba(0,171,206,0.2);
            min-width: 160px;
        }

        .year-badge {
            background: linear-gradient(135deg, #00abce, #73a535);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1.8em;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }

        .year-label {
            color: #925333;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
            line-height: 1.2;
        }

        .forms-visual {
            flex: 1;
            display: flex;
            gap: 25px;
            align-items: flex-end;
            padding: 20px 0;
            justify-content: center;
            overflow: hidden;
            min-height: 140px;
        }
        
        /* Clickable Form Bar */
        .form-bar {
            flex: 1;
            max-width: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .form-bar:hover {
            transform: translateY(-5px);
        }

        .form-bar-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: inherit;
        }

        .form-bar-count {
            background: #925333;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.3s ease;
        }

        .form-bar:hover .form-bar-count {
            background: #73a535;
        }

        .form-bar-fill {
            width: 60px;
            background: linear-gradient(180deg, #00abce, #73a535);
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            position: relative;
            min-height: 10px;
            box-shadow: 0 -2px 10px rgba(0,171,206,0.3);
        }

        .form-bar:hover .form-bar-fill {
            box-shadow: 0 -4px 20px rgba(0,171,206,0.5);
            background: linear-gradient(180deg, #00c4e8, #7fb53f);
        }

        .form-bar-label {
            background: rgba(146, 83, 51, 0.1);
            padding: 8px 15px;
            border-radius: 0 0 10px 10px;
            width: 100%;
            text-align: center;
            font-size: 0.85em;
            font-weight: 600;
            color: #925333;
            border: 2px solid rgba(146, 83, 51, 0.2);
            border-top: none;
            margin-top: -2px;
            transition: all 0.3s ease;
        }

        .form-bar:hover .form-bar-label {
            background: rgba(0, 171, 206, 0.1);
            border-color: rgba(0, 171, 206, 0.3);
        }

        .form-bar-states {
            font-size: 0.7em;
            color: #666;
            font-weight: 400;
            margin-top: 2px;
        }

        .click-hint {
            font-size: 0.65em;
            color: #00abce;
            margin-top: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .form-bar:hover .click-hint {
            opacity: 1;
        }
        
        /* Reports Section */
        .reports-content {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        .reports-main {
            flex: 2;
        }

        .reports-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            max-width: none;
        }

        .tepper-fellows-info {
            flex: 1;
            background: rgba(115, 165, 53, 0.1);
            border-radius: 15px;
            padding: 25px;
            border-left: 4px solid #73a535;
            min-width: 300px;
        }

        .tepper-fellows-info h3 {
            color: #925333;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            font-family: 'Montserrat', sans-serif;
        }

        .tepper-fellows-info p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 20px;
            font-family: 'Frank Ruhl Libre', serif;
            font-size: 1em;
        }

        .tepper-link {
            display: inline-block;
            color: #73a535;
            text-decoration: none;
            font-weight: 500;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.95em;
            transition: color 0.3s ease;
        }

        .tepper-link:hover {
            color: #925333;
            text-decoration: underline;
        }

        .report-link {
            display: block;
            padding: 15px 20px;
            background: linear-gradient(135deg, #00abce, #73a535);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .report-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background: linear-gradient(135deg, #925333, #73a535);
        }
        
        /* Acknowledgment Section */
        .acknowledgment {
            background: linear-gradient(135deg, #925333, #73a535);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .acknowledgment h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .acknowledgment p {
            color: rgba(255,255,255,0.95);
            font-style: italic;
        }
        
        /* Remove zoom controls from Leaflet */
        .leaflet-control-zoom {
            display: none !important;
        }
        
        .leaflet-control-attribution
        /* Desktop: Hide mobile list, show map */
.mobile-state-list {
    display: none;
}

/* Mobile styles */
@media screen and (max-width: 768px) {
    /* Hide map on mobile */
    #map, .map-content {
        display: none !important;
    }
    
    /* Show state list on mobile */
    .mobile-state-list {
        display: block !important;
        padding: 20px;
        background: white;
        border-radius: 10px;
        margin: 10px;
    }
    
    /* State list styles */
    .year-context {
        text-align: center;
        font-size: 1.1em;
        color: #925333;
        margin-bottom: 15px;
        font-weight: 600;
    }
    
    .state-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        max-height: 500px;
        overflow-y: auto;
    }
    
    .state-btn {
        display: flex;
        align-items: center;
        gap: 5px;
        padding: 10px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 13px;
        text-align: left;
        width: 100%;
    }
    
    /* Basic mobile adjustments */
    .grunin-branding {
        flex-direction: column;
        text-align: center;
    }
    
    .container {
        padding: 10px;
    }
    
    body {
        padding-bottom: 50px;
    }
}
@media (max-width: 480px) {
    .container {
        padding: 8px !important;
        padding-bottom: 5px !important;
    }
    
    .stats-bar {
        margin-left: -8px !important;
        margin-right: -8px !important;
        padding: 15px 5px !important;
        min-height: 240px !important;
    }
    
    .forms-visual {
        padding: 12px 3px 15px !important;
        gap: 6px !important;
        min-height: 180px !important;
    }
    
    .form-bar-fill {
        width: 35px !important;
    }
    
    .form-bar-label {
        font-size: 0.7em !important;
        padding: 5px 8px !important;
    }
    
    .legend-item {
        font-size: 10px !important;
        padding: 4px !important;
        gap: 3px !important;
    }
    
    .legend-item span:first-child {
        font-size: 13px !important;
    }
    
    #map {
        height: 350px !important;
    }
}  </style>
</head>
<body>
    <div class="container">
        <div class="grunin-branding">
<img src="gruninlogo.png"
    alt="Grunin Center Logo" 
                 class="grunin-logo-img">
            <div class="grunin-title">
                <div class="grunin-name">Grunin Center for Law and Social Entrepreneurship</div>
                <div class="grunin-subtitle">NYU School of Law</div>
            </div>
        </div>
        
        <div class="header">
            <h1>Social Enterprise Legislative Tracker</h1>
        </div>
        
        <!-- About Section -->
        <div class="content-section">
            <h2>About</h2>
            <p>Welcome to the Social Enterprise Law Tracker ("SELT"). Beginning in 2008, state legislatures started authorizing a new class of entities collectively known as <em>social enterprises</em>. These corporate and company forms are designed for businesses that seek to create positive social and environmental impacts in addition to financial returns. These forms include the benefit corporation (Benefit Corps), the social purpose corporation (SPC), the low-profit limited liability company (L3C), the benefit limited liability company (BLLC), and the statutory public benefit limited partnership (SPBLP).</p>
            
            <p>The SELT visualizes how social enterprise law has spread across the US. Select any state to see the social enterprise forms that are available, and historic legislative activity.</p>
            
            <p>The SELT was developed by Rob Esposito and Shawn Pelsinger, with support from the NYU Jacobson Leadership Program in Law & Business, the NYU Stern Business & Society Program, and the NYU Law and Social Entrepreneurship Association. The SELT is now hosted and maintained by the Grunin Center for Law and Social Entrepreneurship.</p>
        </div>
        
        <!-- Forms Definitions Section -->
        <div class="content-section">
            <h2>Social Enterprise Corporate Forms Defined</h2>
            <p>The SELT tracks the following five corporate forms, each designed to support businesses pursuing both profit and positive social or environmental impact:</p>
            
            <p><strong>Benefit Corporation (BCORP)</strong> is the most widely adopted form, requiring companies to pursue general public benefit alongside profit. Directors must consider stakeholder interests beyond shareholders in decision-making.</p>
            
            <p><strong>Social Purpose Corporation (SPC)</strong> allows corporations to define specific social or environmental purposes in addition to profit maximization. It provides flexibility in how companies balance financial and social objectives.</p>
            
            <p><strong>Low-profit Limited Liability Company (L3C)</strong> is designed primarily for charitable purposes with limited profit distribution. It was originally created to facilitate program-related investments (PRIs) by foundations.</p>
            
            <p><strong>Benefit Limited Liability Company (BLLC)</strong> combines the flexibility of LLC structure with benefit corporation principles. Currently available only in Delaware, it offers LLC tax treatment with social benefit requirements.</p>
            
            <p><strong>Social Purpose Benefit Limited Partnership (SPBLP)</strong> provides a limited partnership structure for social enterprises, particularly suited for impact investing. Also currently available only in Delaware for sophisticated investment arrangements.</p>
        </div>
        
        <div class="map-section">
            <div class="map-controls">
                <div class="controls-row">
                    <div class="control-group">
                        <span class="control-label">Year:</span>
                        <select id="yearSelect">
                            <!-- Will be populated by JS -->
                        </select>
                    </div>
                    <div class="legend" id="legend">
                        <!-- Will be populated by JS -->
                    </div>
                </div>
            </div>
            <div class="map-content">
                <div id="map"></div>
            </div>
            
          <!-- Mobile State List (hidden on desktop, shown on mobile) -->
<div class="mobile-state-list" id="mobileStateList">
    <div class="year-context">
    <span id="mobileYearDisplay">2024</span> Data
</div>
    
    <div class="state-grid">
        <button onclick="location.href='states/al.html'" class="state-btn">
            <span class="state-code">AL</span>
            <span class="state-name">Alabama</span>
        </button>
        <button onclick="location.href='states/ak.html'" class="state-btn">
            <span class="state-code">AK</span>
            <span class="state-name">Alaska</span>
        </button>
        <button onclick="location.href='states/az.html'" class="state-btn">
            <span class="state-code">AZ</span>
            <span class="state-name">Arizona</span>
        </button>
        <button onclick="location.href='states/ar.html'" class="state-btn">
            <span class="state-code">AR</span>
            <span class="state-name">Arkansas</span>
        </button>
        <button onclick="location.href='states/ca.html'" class="state-btn">
            <span class="state-code">CA</span>
            <span class="state-name">California</span>
        </button>
        <button onclick="location.href='states/co.html'" class="state-btn">
            <span class="state-code">CO</span>
            <span class="state-name">Colorado</span>
        </button>
        <button onclick="location.href='states/ct.html'" class="state-btn">
            <span class="state-code">CT</span>
            <span class="state-name">Connecticut</span>
        </button>
        <button onclick="location.href='states/de.html'" class="state-btn">
            <span class="state-code">DE</span>
            <span class="state-name">Delaware</span>
        </button>
        <button onclick="location.href='states/dc.html'" class="state-btn">
            <span class="state-code">DC</span>
            <span class="state-name">District of Columbia</span>
        </button>
        <button onclick="location.href='states/fl.html'" class="state-btn">
            <span class="state-code">FL</span>
            <span class="state-name">Florida</span>
        </button>
        <button onclick="location.href='states/ga.html'" class="state-btn">
            <span class="state-code">GA</span>
            <span class="state-name">Georgia</span>
        </button>
        <button onclick="location.href='states/hi.html'" class="state-btn">
            <span class="state-code">HI</span>
            <span class="state-name">Hawaii</span>
        </button>
        <button onclick="location.href='states/id.html'" class="state-btn">
            <span class="state-code">ID</span>
            <span class="state-name">Idaho</span>
        </button>
        <button onclick="location.href='states/il.html'" class="state-btn">
            <span class="state-code">IL</span>
            <span class="state-name">Illinois</span>
        </button>
        <button onclick="location.href='states/in.html'" class="state-btn">
            <span class="state-code">IN</span>
            <span class="state-name">Indiana</span>
        </button>
        <button onclick="location.href='states/ia.html'" class="state-btn">
            <span class="state-code">IA</span>
            <span class="state-name">Iowa</span>
        </button>
        <button onclick="location.href='states/ks.html'" class="state-btn">
            <span class="state-code">KS</span>
            <span class="state-name">Kansas</span>
        </button>
        <button onclick="location.href='states/ky.html'" class="state-btn">
            <span class="state-code">KY</span>
            <span class="state-name">Kentucky</span>
        </button>
        <button onclick="location.href='states/la.html'" class="state-btn">
            <span class="state-code">LA</span>
            <span class="state-name">Louisiana</span>
        </button>
        <button onclick="location.href='states/me.html'" class="state-btn">
            <span class="state-code">ME</span>
            <span class="state-name">Maine</span>
        </button>
        <button onclick="location.href='states/md.html'" class="state-btn">
            <span class="state-code">MD</span>
            <span class="state-name">Maryland</span>
        </button>
        <button onclick="location.href='states/ma.html'" class="state-btn">
            <span class="state-code">MA</span>
            <span class="state-name">Massachusetts</span>
        </button>
        <button onclick="location.href='states/mi.html'" class="state-btn">
            <span class="state-code">MI</span>
            <span class="state-name">Michigan</span>
        </button>
        <button onclick="location.href='states/mn.html'" class="state-btn">
            <span class="state-code">MN</span>
            <span class="state-name">Minnesota</span>
        </button>
        <button onclick="location.href='states/ms.html'" class="state-btn">
            <span class="state-code">MS</span>
            <span class="state-name">Mississippi</span>
        </button>
        <button onclick="location.href='states/mo.html'" class="state-btn">
            <span class="state-code">MO</span>
            <span class="state-name">Missouri</span>
        </button>
        <button onclick="location.href='states/mt.html'" class="state-btn">
            <span class="state-code">MT</span>
            <span class="state-name">Montana</span>
        </button>
        <button onclick="location.href='states/ne.html'" class="state-btn">
            <span class="state-code">NE</span>
            <span class="state-name">Nebraska</span>
        </button>
        <button onclick="location.href='states/nv.html'" class="state-btn">
            <span class="state-code">NV</span>
            <span class="state-name">Nevada</span>
        </button>
        <button onclick="location.href='states/nh.html'" class="state-btn">
            <span class="state-code">NH</span>
            <span class="state-name">New Hampshire</span>
        </button>
        <button onclick="location.href='states/nj.html'" class="state-btn">
            <span class="state-code">NJ</span>
            <span class="state-name">New Jersey</span>
        </button>
        <button onclick="location.href='states/nm.html'" class="state-btn">
            <span class="state-code">NM</span>
            <span class="state-name">New Mexico</span>
        </button>
        <button onclick="location.href='states/ny.html'" class="state-btn">
            <span class="state-code">NY</span>
            <span class="state-name">New York</span>
        </button>
        <button onclick="location.href='states/nc.html'" class="state-btn">
            <span class="state-code">NC</span>
            <span class="state-name">North Carolina</span>
        </button>
        <button onclick="location.href='states/nd.html'" class="state-btn">
            <span class="state-code">ND</span>
            <span class="state-name">North Dakota</span>
        </button>
        <button onclick="location.href='states/oh.html'" class="state-btn">
            <span class="state-code">OH</span>
            <span class="state-name">Ohio</span>
        </button>
        <button onclick="location.href='states/ok.html'" class="state-btn">
            <span class="state-code">OK</span>
            <span class="state-name">Oklahoma</span>
        </button>
        <button onclick="location.href='states/or.html'" class="state-btn">
            <span class="state-code">OR</span>
            <span class="state-name">Oregon</span>
        </button>
        <button onclick="location.href='states/pa.html'" class="state-btn">
            <span class="state-code">PA</span>
            <span class="state-name">Pennsylvania</span>
        </button>
        <button onclick="location.href='states/ri.html'" class="state-btn">
            <span class="state-code">RI</span>
            <span class="state-name">Rhode Island</span>
        </button>
        <button onclick="location.href='states/sc.html'" class="state-btn">
            <span class="state-code">SC</span>
            <span class="state-name">South Carolina</span>
        </button>
        <button onclick="location.href='states/sd.html'" class="state-btn">
            <span class="state-code">SD</span>
            <span class="state-name">South Dakota</span>
        </button>
        <button onclick="location.href='states/tn.html'" class="state-btn">
            <span class="state-code">TN</span>
            <span class="state-name">Tennessee</span>
        </button>
        <button onclick="location.href='states/tx.html'" class="state-btn">
            <span class="state-code">TX</span>
            <span class="state-name">Texas</span>
        </button>
        <button onclick="location.href='states/ut.html'" class="state-btn">
            <span class="state-code">UT</span>
            <span class="state-name">Utah</span>
        </button>
        <button onclick="location.href='states/vt.html'" class="state-btn">
            <span class="state-code">VT</span>
            <span class="state-name">Vermont</span>
        </button>
        <button onclick="location.href='states/va.html'" class="state-btn">
            <span class="state-code">VA</span>
            <span class="state-name">Virginia</span>
        </button>
        <button onclick="location.href='states/wa.html'" class="state-btn">
            <span class="state-code">WA</span>
            <span class="state-name">Washington</span>
        </button>
        <button onclick="location.href='states/wv.html'" class="state-btn">
            <span class="state-code">WV</span>
            <span class="state-name">West Virginia</span>
        </button>
        <button onclick="location.href='states/wi.html'" class="state-btn">
            <span class="state-code">WI</span>
            <span class="state-name">Wisconsin</span>
        </button>
        <button onclick="location.href='states/wy.html'" class="state-btn">
            <span class="state-code">WY</span>
            <span class="state-name">Wyoming</span>
        </button>
    </div>
</div> 
            
            <!-- Stats Bar with Form Visualization -->
            <div class="stats-bar" id="statsBar">
                <div class="stats-year-indicator">
                    <div class="year-badge" id="yearBadge">2024</div>
                    <div class="year-label">Forms Active in This Year</div>
                </div>
                
                <div class="forms-visual" id="formsVisual">
                    <!-- Form bars will be dynamically populated -->
                </div>
            </div>
        </div>
        
        <!-- Reports Section -->
        <div class="content-section">
            <div class="reports-content">
                <div class="reports-main">
                    <h2>Annual Reports: The State of Social Enterprise and the Law</h2>
                    <p>The Grunin Center publishes comprehensive annual reports tracking US social enterprise legislative developments from 2009 to the present.</p>
                    
                    <div class="reports-grid">
                        <a href="https://www.law.nyu.edu/centers/grunin-social-entrepreneurship/resources/publications" target="_blank" class="report-link">
                            ðŸ“Š Access All Reports and Publications
                        </a>
                    </div>
                </div>
                
                <div class="tepper-fellows-info">
                    <h3>About the Tepper Fellows</h3>
                    <p>Each year, the Grunin Center selects up to five student Research Assistants as Tepper Fellows. These Fellows maintain the Social Enterprise Law Tracker and author the annual reports.</p>
                    <a href="https://www.law.nyu.edu/centers/grunin-social-entrepreneurship/courses-programs/tepper-fellows" target="_blank" class="tepper-link">
                        Learn more about our current Tepper Fellows â†’
                    </a>
                </div>
            </div>
            
            <div class="acknowledgment">
                <h3>Acknowledgment</h3>
                <p>This research project is generously funded by the Tepper Family. We would like to extend our gratitude to the Tepper Family, with particular thanks to Marvin Tepper '58, Elise Tepper, Jacqueline Tepper '90, Edward Tepper, and Shelley Tepper.</p>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // State names mapping
        const stateNames = {
            'AL': 'Alabama', 'AK': 'Alaska', 'AZ': 'Arizona', 'AR': 'Arkansas', 'CA': 'California',
            'CO': 'Colorado', 'CT': 'Connecticut', 'DE': 'Delaware', 'FL': 'Florida', 'GA': 'Georgia',
            'HI': 'Hawaii', 'ID': 'Idaho', 'IL': 'Illinois', 'IN': 'Indiana', 'IA': 'Iowa',
            'KS': 'Kansas', 'KY': 'Kentucky', 'LA': 'Louisiana', 'ME': 'Maine', 'MD': 'Maryland',
            'MA': 'Massachusetts', 'MI': 'Michigan', 'MN': 'Minnesota', 'MS': 'Mississippi', 'MO': 'Missouri',
            'MT': 'Montana', 'NE': 'Nebraska', 'NV': 'Nevada', 'NH': 'New Hampshire', 'NJ': 'New Jersey',
            'NM': 'New Mexico', 'NY': 'New York', 'NC': 'North Carolina', 'ND': 'North Dakota', 'OH': 'Ohio',
            'OK': 'Oklahoma', 'OR': 'Oregon', 'PA': 'Pennsylvania', 'RI': 'Rhode Island', 'SC': 'South Carolina',
            'SD': 'South Dakota', 'TN': 'Tennessee', 'TX': 'Texas', 'UT': 'Utah', 'VT': 'Vermont',
            'VA': 'Virginia', 'WA': 'Washington', 'WV': 'West Virginia', 'WI': 'Wisconsin', 'WY': 'Wyoming'
        };
        
        // Legislative Data (from your original file)
        const legislativeData = {
          "2008": {
            "VT": { "forms": ["L3C"], "failed": [], "rescinded": [] }
          },
          
          "2009": {
            "VT": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "MI": { "forms": ["L3C"], "failed": [], "rescinded": [] },
            "WY": { "forms": ["L3C"], "failed": [], "rescinded": [] },
            "UT": { "forms": ["L3C"], "failed": [], "rescinded": [] },
            "IL": { "forms": ["L3C"], "failed": [], "rescinded": [] }
          },
          
          "2010": {
            "MD": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "NC": { "forms": ["L3C"], "failed": [], "rescinded": [] },
            "LA": { "forms": ["L3C"], "failed": [], "rescinded": [] },
            "ME": { "forms": ["L3C"], "failed": [], "rescinded": [] }
          },
          
          "2011": {
            "NJ": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "VA": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "HI": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "CA": { "forms": ["SPC"], "failed": [], "rescinded": [] },
            "RI": { "forms": ["L3C"], "failed": [], "rescinded": [] }
          },
          
          "2012": {
            "NY": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "CA": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "WA": { "forms": ["SPC"], "failed": [], "rescinded": [] },
            "LA": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "SC": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "MA": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2013": {
            "DE": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "CO": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "AR": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "KY": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "PA": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "IL": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "RI": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2014": {
            "AZ": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "CO": { "forms": ["L3C"], "failed": [], "rescinded": [] },
            "CT": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "DE": { "forms": ["BLLC"], "failed": [], "rescinded": [] },
            "FL": { "forms": ["SPC", "BCORP"], "failed": [], "rescinded": [] },
            "NE": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "NV": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "NH": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "OR": { "forms": ["BCORP", "BLLC"], "failed": [], "rescinded": [] },
            "UT": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "WV": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2015": {
            "ID": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "IN": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "MN": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "MT": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "TN": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2016": {
            "PA": { "forms": ["BLLC"], "failed": [], "rescinded": [] }
          },
          
          "2017": {
            "KS": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "KY": { "forms": ["L3C"], "failed": [], "rescinded": [] },
            "TX": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "WI": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2018": {
            "DE": { "forms": ["SPBLP"], "failed": [], "rescinded": [] },
            "UT": { "forms": ["BLLC"], "failed": [], "rescinded": [] }
          },
          
          "2019": {
            "ME": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "OK": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2020": {
            "AL": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "GA": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "NM": { "forms": ["BCORP"], "failed": [], "rescinded": [] },
            "OH": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2021": {
            "IA": { "forms": ["BCORP"], "failed": [], "rescinded": [] }
          },
          
          "2023": {
            "MI": { "forms": [], "failed": [], "rescinded": [], "underConsideration": ["BCORP"] }
          },
          
          "2024": {
            "MI": { "forms": [], "failed": [], "rescinded": [], "underConsideration": ["BCORP"] },
            "MS": { "forms": [], "failed": ["BCORP"], "rescinded": [] }
          }
        };
        
        // Corporate form definitions
        const corporateForms = {
          "SPC": "Social Purpose Corporation",
          "L3C": "Low-profit Limited Liability Company", 
          "BLLC": "Benefit Limited Liability Company",
          "SPBLP": "Social Purpose Benefit Limited Partnership",
          "BCORP": "Benefit Corporation"
        };
        
        // Helper functions
        function calculateAvailableForms(stateCode, targetYear) {
            const availableForms = new Set();
            
            for (let year = 2008; year <= parseInt(targetYear); year++) {
                const yearData = legislativeData[year.toString()];
                if (yearData && yearData[stateCode]) {
                    const stateData = yearData[stateCode];
                    
                    stateData.forms.forEach(form => availableForms.add(form));
                    stateData.rescinded.forEach(form => availableForms.delete(form));
                }
            }
            
            return Array.from(availableForms);
        }
        
        function getStateActivity(stateCode, year) {
            const yearData = legislativeData[year.toString()];
            if (!yearData || !yearData[stateCode]) {
                return { 
                    status: "none", 
                    emoji: "âšª", 
                    forms: [], 
                    failed: [], 
                    rescinded: [],
                    underConsideration: [],
                    availableForms: calculateAvailableForms(stateCode, year)
                };
            }
            
            const stateData = yearData[stateCode];
            const formsCount = stateData.forms.length;
            const failedCount = stateData.failed.length;
            const rescindedCount = stateData.rescinded.length;
            const underConsiderationCount = stateData.underConsideration ? stateData.underConsideration.length : 0;
            
            let status, emoji;
            
            if (rescindedCount > 0) {
                status = "rescinded";
                emoji = "â›”";
            } else if (failedCount > 0 && formsCount === 0 && underConsiderationCount === 0) {
                status = "failed";
                emoji = "âŒ";
            } else if (formsCount > 0) {
                status = "enacted";
                emoji = "âœ…";
            } else if (underConsiderationCount > 0) {
                status = "underConsideration";
                emoji = "â³";
            } else {
                status = "none";
                emoji = "âšª";
            }
            
            return {
                status: status,
                emoji: emoji,
                forms: stateData.forms,
                failed: stateData.failed,
                rescinded: stateData.rescinded,
                underConsideration: stateData.underConsideration || [],
                availableForms: calculateAvailableForms(stateCode, year)
            };
        }
        
        // State coordinates
        const stateCoordinates = {
            'AL': [32.806671, -86.791130], 'AK': [61.370716, -152.404419], 'AZ': [33.729759, -111.431221],
            'AR': [34.969704, -92.373123], 'CA': [36.116203, -119.681564], 'CO': [39.059811, -105.311104],
            'CT': [41.597782, -72.755371], 'DE': [39.318523, -75.507141], 'FL': [27.766279, -81.686783],
            'GA': [33.040619, -83.643074], 'HI': [21.094318, -157.498337], 'ID': [44.240459, -114.478828],
            'IL': [40.349457, -88.986137], 'IN': [39.849426, -86.258278], 'IA': [42.011539, -93.210526],
            'KS': [38.526600, -96.726486], 'KY': [37.668140, -84.670067], 'LA': [31.169546, -91.867805],
            'ME': [44.693947, -69.381927], 'MD': [39.063946, -76.802101], 'MA': [42.230171, -71.530106],
            'MI': [43.326618, -84.536095], 'MN': [45.694454, -93.900192], 'MS': [32.741646, -89.678696],
            'MO': [38.456085, -92.288368], 'MT': [46.921925, -110.454353], 'NE': [41.125370, -98.268082],
            'NV': [38.313515, -117.055374], 'NH': [43.452492, -71.563896], 'NJ': [40.298904, -74.521011],
            'NM': [34.840515, -106.248482], 'NY': [42.165726, -74.948051], 'NC': [35.630066, -79.806419],
            'ND': [47.528912, -99.784012], 'OH': [40.388783, -82.764915], 'OK': [35.565342, -96.928917],
            'OR': [44.572021, -122.070938], 'PA': [40.590752, -77.209755], 'RI': [41.680893, -71.511780],
            'SC': [33.856892, -80.945007], 'SD': [44.299782, -99.438828], 'TN': [35.747845, -86.692345],
            'TX': [31.054487, -97.563461], 'UT': [40.150032, -111.862434], 'VT': [44.045876, -72.710686],
            'VA': [37.769337, -78.169968], 'WA': [47.400902, -121.490494], 'WV': [38.491226, -80.954456],
            'WI': [44.268543, -89.616508], 'WY': [42.755966, -107.302490]
        };
        
        class EnhancedSELTMap {
            constructor() {
                this.map = null;
                this.stateMarkers = new Map();
                this.selectedState = null;
                this.currentYear = '2024';
                this.originalView = null;
                
                this.initMap();
                this.createStateMarkers();
                this.setupControls();
                this.updateDisplay();
            }
            
            initMap() {
                // Initialize map with locked view
                this.map = L.map('map', {
                    center: [38.5, -98.5795],
                    zoom: 4,
                    zoomControl: false, // Disable zoom controls
                    scrollWheelZoom: false, // Disable scroll zoom
                    doubleClickZoom: false, // Disable double click zoom
                    touchZoom: false, // Disable touch zoom
                    boxZoom: false, // Disable box zoom
                    keyboard: false, // Disable keyboard navigation
                    dragging: false // Disable map dragging
                });
                
                // Store original view
                this.originalView = {
                    center: [38.5, -98.5795],
                    zoom: 4
                };
                
                // Simple tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ''
                }).addTo(this.map);
            }
            
            createStateMarkers() {
                // Northeast states with maximum spacing to prevent any overlap
                const northeastStates = {
                    'ME': { actual: [44.693947, -69.381927], callout: [46.5, -64.5] },   // Far north-east
                    'NH': { actual: [43.452492, -71.563896], callout: [45, -66] },       // Below ME, right
                    'VT': { actual: [44.045876, -72.710686], callout: [44, -68] },       // Left of NH
                    'MA': { actual: [42.230171, -71.530106], callout: [42.5, -65] },     // Below NH, right
                    'RI': { actual: [41.680893, -71.511780], callout: [41, -66.5] },     // Below MA, slightly left
                    'CT': { actual: [41.597782, -72.755371], callout: [40, -68.5] },     // Below VT, left
                    'NJ': { actual: [40.298904, -74.521011], callout: [38.8, -70.5] },   // Further down and left
                    'DE': { actual: [39.318523, -75.507141], callout: [37.5, -72] },     // Below NJ
                    'MD': { actual: [39.063946, -76.802101], callout: [36.5, -74] }      // Southernmost
                };
                
                // Create leader lines for Northeast states
                Object.entries(northeastStates).forEach(([stateCode, positions]) => {
                    // Create the leader line with better visibility
                    const line = L.polyline([positions.actual, positions.callout], {
                        color: '#333',
                        weight: 1.5,
                        opacity: 0.7,
                        dashArray: '3, 3',
                        className: 'leader-line'
                    }).addTo(this.map);
                    
                    // Create the state badge at the callout position
                    const marker = L.marker(positions.callout, {
                        icon: this.createStateBadge(stateCode, true)
                    }).addTo(this.map);
                    
                    // Click handler
                    marker.on('click', () => {
                        // Reset all marker z-indexes first
                        this.stateMarkers.forEach((m, code) => {
                            m.setZIndexOffset(0);
                        });
                        
                        if (this.selectedState === stateCode) {
                            this.selectedState = null;
                            marker.setZIndexOffset(0);
                        } else {
                            this.selectedState = stateCode;
                            // Bring selected marker to front
                            marker.setZIndexOffset(1000);
                        }
                        this.updateDisplay();
                    });
                    
                    this.stateMarkers.set(stateCode, marker);
                });
                
                // Create regular markers for other states (excluding AK and HI)
                Object.entries(stateCoordinates).forEach(([stateCode, coords]) => {
                    // Skip Northeast states, Alaska, and Hawaii
                    if (northeastStates[stateCode] || stateCode === 'AK' || stateCode === 'HI') {
                        return;
                    }
                    
                    const marker = L.marker(coords, {
                        icon: this.createStateBadge(stateCode, false)
                    }).addTo(this.map);
                    
                    // Click handler
                    marker.on('click', () => {
                        // Reset all marker z-indexes first
                        this.stateMarkers.forEach((m, code) => {
                            m.setZIndexOffset(0);
                        });
                        
                        if (this.selectedState === stateCode) {
                            this.selectedState = null;
                            marker.setZIndexOffset(0);
                        } else {
                            this.selectedState = stateCode;
                            // Bring selected marker to front
                            marker.setZIndexOffset(1000);
                        }
                        this.updateDisplay();
                    });
                    
                    this.stateMarkers.set(stateCode, marker);
                });
                
                // Create inset boxes for Alaska and Hawaii
                this.createInsetBoxes();
            }
            
            createInsetBoxes() {
                const mapContainer = document.getElementById('map');
                
                // Create Alaska inset box with state shape
                const alaskaBox = document.createElement('div');
                alaskaBox.className = 'inset-box alaska-box';
                alaskaBox.innerHTML = `
                    <svg class="state-shape-svg" viewBox="0 0 100 70" xmlns="http://www.w3.org/2000/svg">
                        <!-- Alaska with distinctive shape including panhandle -->
                        <g id="alaska-shape">
                            <!-- Main body of Alaska -->
                            <path class="state-shape-path alaska-main" 
                                  d="M 25 50 L 20 45 L 15 40 L 12 32 L 14 25 L 20 20 L 30 18 L 40 16 L 50 17 L 58 20 L 63 25 L 65 32 L 62 38 L 58 42 L 52 45 L 45 48 L 38 50 L 30 51 Z"/>
                            <!-- Aleutian Islands chain -->
                            <circle class="state-shape-path" cx="68" cy="45" r="1.5"/>
                            <circle class="state-shape-path" cx="72" cy="47" r="1"/>
                            <circle class="state-shape-path" cx="75" cy="48" r="1"/>
                            <!-- Southeast panhandle -->
                            <path class="state-shape-path" 
                                  d="M 58 42 L 60 45 L 62 48 L 61 52 L 59 50 L 57 46 Z"/>
                        </g>
                    </svg>
                    <div class="inset-state-label" id="alaska-label">AK âšª</div>
                `;
                mapContainer.appendChild(alaskaBox);
                
                // Create Hawaii inset box with island chain shape  
                const hawaiiBox = document.createElement('div');
                hawaiiBox.className = 'inset-box hawaii-box';
                hawaiiBox.innerHTML = `
                    <svg class="state-shape-svg" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
                        <!-- Hawaiian islands from northwest to southeast -->
                        <g id="hawaii-shape">
                            <!-- Kauai -->
                            <circle class="state-shape-path hawaii-island" cx="20" cy="22" r="3"/>
                            <!-- Oahu -->  
                            <ellipse class="state-shape-path hawaii-island" cx="30" cy="24" rx="3.5" ry="2.5"/>
                            <!-- Molokai -->
                            <ellipse class="state-shape-path hawaii-island" cx="40" cy="25" rx="4" ry="1.5"/>
                            <!-- Lanai -->
                            <circle class="state-shape-path hawaii-island" cx="42" cy="29" r="1.8"/>
                            <!-- Maui -->
                            <path class="state-shape-path hawaii-island" d="M 48 24 L 52 23 L 54 25 L 53 28 L 50 29 L 47 27 Z"/>
                            <!-- Big Island (Hawaii) -->
                            <path class="state-shape-path hawaii-island" 
                                  d="M 65 28 L 70 25 L 75 26 L 77 30 L 76 34 L 72 36 L 68 35 L 65 32 Z"/>
                        </g>
                    </svg>
                    <div class="inset-state-label" id="hawaii-label">HI âšª</div>
                `;
                mapContainer.appendChild(hawaiiBox);
                
                // Add click handlers for Alaska
                const alaskaElement = document.querySelector('.alaska-box');
                alaskaElement.addEventListener('click', () => {
                    if (this.selectedState === 'AK') {
                        this.selectedState = null;
                    } else {
                        this.selectedState = 'AK';
                    }
                    this.updateDisplay();
 this.updateSidebar();
                    this.updateInsetBoxes();
                });
                
                // Add click handler for Hawaii
                const hawaiiElement = document.querySelector('.hawaii-box');
                hawaiiElement.addEventListener('click', () => {
                    if (this.selectedState === 'HI') {
                        this.selectedState = null;
                    } else {
                        this.selectedState = 'HI';
                    }
                    this.updateDisplay();
 this.updateSidebar(); 
                    this.updateInsetBoxes();
                });
                
                // Store references for updating
                this.alaskaShapes = document.querySelectorAll('.alaska-box .state-shape-path');
                this.hawaiiIslands = document.querySelectorAll('.hawaii-island');
                this.alaskaLabel = document.getElementById('alaska-label');
                this.hawaiiLabel = document.getElementById('hawaii-label');
            }
            
            updateInsetBoxes() {
                // Update Alaska
                const akActivity = getStateActivity('AK', this.currentYear);
                this.alaskaLabel.textContent = `AK ${akActivity.emoji}`;
                this.alaskaShapes.forEach(shape => {
                    shape.className.baseVal = this.selectedState === 'AK' ? 
                        'state-shape-path selected' : 'state-shape-path';
                });
                
                // Update Hawaii
                const hiActivity = getStateActivity('HI', this.currentYear);
                this.hawaiiLabel.textContent = `HI ${hiActivity.emoji}`;
                this.hawaiiIslands.forEach(island => {
                    island.className.baseVal = this.selectedState === 'HI' ? 
                        'state-shape-path hawaii-island selected' : 'state-shape-path hawaii-island';
                });
            }
            
            setupControls() {
                // Populate year dropdown
                const yearSelect = document.getElementById('yearSelect');
                for (let year = 2024; year >= 2008; year--) {
                    const option = document.createElement('option');
                    option.value = year.toString();
                    option.textContent = year;
                    yearSelect.appendChild(option);
                }
                
yearSelect.addEventListener('change', (e) => {
    this.currentYear = e.target.value;
    this.updateDisplay();
    this.updateSidebar(); 
    this.updateFormBars();
    // Update year badge
    document.getElementById('yearBadge').textContent = this.currentYear;
    // Update mobile year display
    const mobileYear = document.getElementById('mobileYearDisplay');
    if (mobileYear) {
        mobileYear.textContent = e.target.value;
    }
});
                
                // Initialize displays
                this.updateLegend();
                this.updateFormBars();
            }
            
            createStateBadge(stateCode, isNortheast = false) {
                let className = isNortheast ? 'state-badge northeast' : 'state-badge';
                let markerClassName = 'state-badge-marker';
                
                if (this.selectedState === stateCode) {
                    className += ' selected';
                    markerClassName += ' selected-marker';
                }
                
                const activity = getStateActivity(stateCode, this.currentYear);
                const html = `<div class="${className}">${stateCode} ${activity.emoji}</div>`;
                return L.divIcon({
                    html: html,
                    iconSize: null,
                    className: markerClassName
                });
            }
            
            updateDisplay() {
                // Update regular state markers
                this.stateMarkers.forEach((marker, code) => {
                    // Skip Alaska and Hawaii as they're handled by inset boxes
                    if (code === 'AK' || code === 'HI') {
                        return;
                    }
                    // Determine if state is in northeast
                    const northeastStates = ['ME', 'CT', 'DE', 'MD', 'MA', 'NH', 'NJ', 'RI', 'VT'];
                    const isNortheast = northeastStates.includes(code);
                    marker.setIcon(this.createStateBadge(code, isNortheast));
                    
                    // Manage z-index - bring selected state to front
                    if (this.selectedState === code) {
                        marker.setZIndexOffset(1000);
                    } else {
                        marker.setZIndexOffset(0);
                    }
                });
                
                // Update inset boxes if they exist
                if (this.alaskaLabel && this.hawaiiLabel) {
                    this.updateInsetBoxes();
                }
            }
            
          // Whatever code ends here (probably line 1479 or 1480)
            
updateSidebar() {
    // Simple mobile popup for state details  
    if (this.selectedState) {
        const stateName = stateNames[this.selectedState] || this.selectedState;
        alert(`${stateName}\n\nView details at: states/${this.selectedState.toLowerCase()}.html`);
    }
}
            
            
            updateLegend() {
                const legend = document.getElementById('legend');
                
                legend.innerHTML = `
                    <div class="legend-item">
                        <span style="font-size: 16px;">âšª</span>
                        <span>No Activity</span>
                    </div>
                    <div class="legend-item">
                        <span style="font-size: 16px;">âœ…</span>
                        <span>Enacted Form(s)</span>
                    </div>
                    <div class="legend-item">
                        <span style="font-size: 16px;">âŒ</span>
                        <span>Failed Legislation</span>
                    </div>
                    <div class="legend-item">
                        <span style="font-size: 16px;">â³</span>
                        <span>Under Consideration</span>
                    </div>
                    <div class="legend-item">
                        <span style="font-size: 16px;">â›”</span>
                        <span>Repealed</span>
                    </div>
                `;
            }
            
            updateFormBars() {
                const allStates = Array.from(this.stateMarkers.keys());
                
                // Count states for each form type in the current year
                const formCounts = {};
                
                allStates.forEach(stateCode => {
                    const activity = getStateActivity(stateCode, this.currentYear);
                    activity.availableForms.forEach(form => {
                        if (!formCounts[form]) {
                            formCounts[form] = 0;
                        }
                        formCounts[form]++;
                    });
                });

                // Sort forms by count
                const sortedForms = Object.entries(formCounts).sort((a, b) => b[1] - a[1]);
                
                // Create visual bars
                const formsVisual = document.getElementById('formsVisual');
                formsVisual.innerHTML = '';
                
                if (sortedForms.length === 0) {
                    formsVisual.innerHTML = '<div style="color: #999; font-style: italic;">No forms available in ' + this.currentYear + '</div>';
                } else {
                    const maxCount = sortedForms[0][1];
                    
                    sortedForms.forEach(([formCode, count]) => {
                        const height = Math.max(10, (count / maxCount) * 110);
                        const stateText = count === 1 ? '1 state' : `${count} states`;
                        
                        const formBar = document.createElement('div');
                        formBar.className = 'form-bar';
                        formBar.dataset.formtype = formCode;
                        formBar.onclick = () => {
                            window.location.href = `forms/${formCode.toLowerCase()}.html`;
                        };
                        
                        formBar.innerHTML = `
                            <div class="form-bar-wrapper">
                                <div class="form-bar-count">${count}</div>
                                <div class="form-bar-fill" style="height: ${height}px;"></div>
                                <div class="form-bar-label">
                                    ${formCode}
                                    <div class="form-bar-states">${stateText}</div>
                                    <div class="click-hint">Click for timeline â†’</div>
                                </div>
                            </div>
                        `;
                        
                        formsVisual.appendChild(formBar);
                    });
                }
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new EnhancedSELTMap();
        });
    </script>
</body>
</html>
